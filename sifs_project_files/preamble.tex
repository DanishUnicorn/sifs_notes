% cSpell:disable

% LAYOUT --------------------------------------- 

% Page setup etc. packages
\usepackage{geometry} % For customizing page layout
\usepackage{setspace} % For setting line spacing
\usepackage{fancyhdr} % Headers, footers, page number etc.
\usepackage{textpos} % For text positioning
\usepackage{mathptmx} % Use Times New Roman font
\usepackage[T1]{fontenc} % For font encoding

\renewcommand{\headrulewidth}{0pt} % Remove header line
\fancypagestyle{plain}{ % Redefine the plain page style
\fancyhf{} % Clear footer 
}

% Set paper-size and margins
\geometry{a4paper,
hmargin = {25.4mm, 25.4mm}, % Right and left margin
vmargin = {30mm, 30mm} % Top and bottom margin
}

% Line spacing and lists
\usepackage{enumitem} % For customizing lists
\usepackage{caption} % For customizing captions

\setlist{noitemsep} % No space between list items
\setlist{nosep} % No space around list items

\captionsetup[table]{position=above, skip=5pt} % Set table captions above tables with 5pt space
\captionsetup[figure]{position=below, skip=5pt} % Set figure captions below figures with 5pt space

\onehalfspacing % Set line spacing to 1.5
\setlength{\parindent}{0pt} % No indent on new paragraphs

\pagestyle{fancy}
\fancyhf{} % Clear all header and footer fields

% Set header font to Times New Roman
\fancyhead[L]{\fontfamily{ptm}\selectfont Chapter \thechapter} % Left header
\fancyhead[R]{\fontfamily{ptm}\selectfont \rightmark} % Right header

% Set footer
\fancyfoot[C]{\thepage} % Center footer with page number

% Ensure the header uses Times New Roman
\renewcommand{\chaptermark}[1]{\markboth{\fontfamily{ptm}\selectfont Chapter \thechapter}{}} % Chapter mark
\renewcommand{\sectionmark}[1]{\markright{\fontfamily{ptm}\selectfont \thesection\ #1}} % Section mark

% Color stuff
\usepackage[dvipsnames]{xcolor} % For color definitions
\usepackage{transparent} % For transparency in color definitions
\usepackage{soul} % For highlighting text
\usepackage[normalem]{ulem} % For underlining text while allowing underline


\definecolor{lightblue}{RGB}{247, 247, 252} % Custom color lightblue
\definecolor{lightgrey}{RGB}{247, 247, 247} % Custom color lightgrey
\definecolor{darkblue}{RGB}{41, 82, 163} % Custom color darkblue
\definecolor{brightgreen}{RGB}{82, 163, 0} % Custom color brightgreen
\definecolor{apricot}{rgb}{0.98, 0.81, 0.69} % Custom color apricot

% APPENDIX SETUP -----------------------------------
\usepackage{appendix} % For setting up appendix titles

% FONT STUFF ----------------------------------------
\usepackage{setspace} % For line spacing
\onehalfspacing % Set line spacing to 1.5

\usepackage{mathptmx} % Use Times New Roman font
\usepackage[T1]{fontenc} % For font encoding
\usepackage{titlesec} % For setting fonts on titles
\usepackage{tocloft} % For customizing TOC
\usepackage{anyfontsize} % For setting custom font sizes

\titleformat{\chapter}[display]{\Huge\bfseries\fontencoding{T1}\rmfamily\selectfont}{Chapter \thechapter}{0ex}{}[] % Set chapter font

% Set section, subsection and subsubsection fonts
\titleformat*{\section}{\fontsize{18}{21.6}\selectfont\bfseries\fontencoding{T1}\rmfamily\selectfont} 
\titleformat*{\subsection}{\fontsize{14}{16.8}\selectfont\bfseries\fontencoding{T1}\rmfamily\selectfont}
\titleformat*{\subsubsection}{\fontsize{12}{14.4}\selectfont\bfseries\fontencoding{T1}\rmfamily\selectfont}
\titleclass{\subsubsubsection}{straight}[\subsection] % Create subsubsubsection

\newcounter{subsubsubsection}[subsubsection] % This and below is for specifying the design of the subsubsubsection
\renewcommand\thesubsubsubsection{\thesubsubsection.\arabic{subsubsubsection}}
\titleformat{\subsubsubsection}
  {\normalfont\fontsize{12}{14.4}\bfseries}{\thesubsubsubsection}{1em}{}
\titlespacing*{\subsubsubsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\setcounter{secnumdepth}{4} % Allow numbering up to \subsubsubsection
\setcounter{tocdepth}{4}   % Include \subsubsubsection in the table of contents

\renewcommand{\cfttoctitlefont}{\huge\bfseries\fontencoding{T1}\rmfamily\selectfont} % Set TOC title font
  
% FIGURES AND FLOATS ---------------------------------------
\usepackage{graphicx} % Required for inserting images
\usepackage{tikz} % Required for drawing
\usepackage{tabularx} % For customizing tables
\usepackage{subcaption} % For subfigures
\usepackage{multicol} % For multiple columns
\usepackage{parcolumns} % For parallel columns
\usepackage{enumitem} % For better control over item spacing in parcolumns pckg
\usepackage{float} % For better control over float positions
\usepackage{array} % For customizing arrays
\usepackage{makecell} % For customizing cells in tables
\usepackage{multirow,bigdelim} % For multirow and bigdelim in tables
\usepackage{longtable} % For tables that span multiple pages
\usepackage[utf8]{inputenc} % For special characters in tables
\usepackage{seqsplit} % For splitting long sequences
\usepackage{eso-pic} % For adding images to title page
\usepackage[table]{xcolor} % For coloring rows in tables
\usepackage{placeins} % For controlling float positions

\usetikzlibrary{fit, backgrounds} % For fitting nodes in tikz
\usetikzlibrary{arrows,shapes,positioning,decorations.pathreplacing} % For arrows and shapes in tikz
\usetikzlibrary{decorations.pathmorphing} % For snake lines in tikz

\usepackage{caption} % For customizing captions
\captionsetup{
  labelfont=bf, % Bold label (Figure x.x, Table x.x)
  textfont=it % Italic text for the caption
}

% REFERENCING AND CITING ---------------------------------------
\usepackage[sorting=none]{biblatex} % Add sorting=none to order by citation
\usepackage{hyperref} % Hyperrefs in TOC, cites, refs etc.
\usepackage{pdfpages} % For including pdfs in the appendix
\usepackage{url} % For including urls in the .bib file (if needed for slides)


\addbibresource{references.bib}
\setcounter{tocdepth}{3}

\makeatletter % Add subsubsubsection to TOC
\newcommand{\l@subsubsubsection}{\@dottedtocline{4}{7em}{4em}}
\makeatother % Add subsubsubsection to TOC

\hypersetup{ % Set hyperref link colors
    colorlinks,
    citecolor=black,  
    filecolor=black,
    linkcolor=black,
    urlcolor=blue
    }

\urlstyle{same} % Set the URL-font to the same as the rest of the document

\renewcommand*{\bibfont}{\fontfamily{ptm}\selectfont} % Ensure bibliography is in Times New Roman

\setcounter{secnumdepth}{4} % Allow numbering up to \subsubsubsection
\setcounter{tocdepth}{4}   % Include \subsubsubsection in the table of contents

\hypersetup{ % Set hyperref link colors and bookmark depth
    colorlinks,
    citecolor=black,  
    filecolor=black,
    linkcolor=black,
    urlcolor=blue,
    bookmarksdepth=4 % Ensure bookmarks include \subsubsubsection
}

% MATH MODE PACKAGES  ---------------------------------------
\usepackage{amsmath} % For math stuff
\usepackage{amstext} % for \text macro
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{nicematrix} % For creating nice matrices
\usepackage{booktabs} % For making tables look nice
\renewcommand{\arrayrulewidth}{0.5pt} % Set table line width

% Custom math operators
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator{\E}{\mathbb{E}} % blackboard E (expectation)
\DeclareMathOperator{\R}{\mathbb{R}} % blackboard R (real number)
\newcommand{\dbar}[1]{\bar{\bar{#1}}} % double bar over symbol
\newcommand{\mtext}[1]{\textbf{#1} \quad} % text before equation
\newcommand{\card}[1]{\vert #1 \vert} % cardinality sign

% CODE PACKAGES -------------------------------------
\usepackage{listings}  
\usepackage{textcomp} % special character package for making code copy-able

\definecolor{codebackground}{HTML}{f7f7f7} % background for code listings
\definecolor{codecomment}{HTML}{55aa55} % comment color for code listings
\definecolor{codekeyword}{HTML}{bc5a65} % keyword color for code listings
\definecolor{codestring}{HTML}{317ecc} % string color for code listings

% Setting up custom code style
\lstdefinestyle{codestyle}{
    language=R,
    backgroundcolor=\color{codebackground},
    basicstyle=\ttfamily, % style of base font settings
    keywordstyle=\color{codekeyword}, % style of arrows, functions etc.
    identifierstyle=, % style of variable names
    commentstyle=\color{codecomment}, % style of comments
    stringstyle=\color{codestring}, % style of strings (everything in "")
    frame=lines, % top and bottom frame (used as padding)
    framerule=5pt, % width of frame rules
    rulecolor=\color{codebackground}, % set color of frame rules
    upquote=true, % setting for making code copy-able
    columns=fullflexible % setting for making code copy-able
}

\lstset{style=codestyle} % define default code-listing style

\lstdefinestyle{outputstyle}{
    language=R,
    backgroundcolor=,
    basicstyle=\ttfamily, % style of base font settings
    keywordstyle=, % style of arrows, functions etc.
    identifierstyle=, % style of variable names
    commentstyle=, % style of comments
    stringstyle=, % style of strings (everything in "")
    frame=lines, % top and bottom frame (used as padding)
    framerule=5pt, % width of frame rules
    rulecolor=\color{white}, % set color of frame rules
    upquote=true, % setting for making code copy-able
    columns=fullflexible % setting for making code copy-able
}

% COLOR BOXES ---------------------------------------
\usepackage[theorems, many]{tcolorbox} % For creating colored boxes

%\newtcbtheorem[⟨initoptions⟩]{⟨name⟩}{⟨displayname⟩}{⟨options⟩}{⟨prefix⟩}

\newtcbtheorem[auto counter, number within=chapter]{theorem}{Theorem} % Theorem box
{colback=lightblue, % Background color
colframe=darkblue, % Frame color
coltitle=darkblue, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Theorem~\thetcbcounter, % Title
separator sign = \quad, % Seperator between label and title
list entry=Theorem~\thetcbcounter \quad #2, % List entry
boxrule=0.5pt, % Frame width
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
detach title, % Title is not part of the box
code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}} % Add title back
}{th}

\newtcbtheorem[auto counter, number within=chapter]{definition}{Definition} % Definition box
{colback=lightblue, % Background color
colframe=darkblue, % Frame color
coltitle=darkblue, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Definition~\thetcbcounter, % Title
separator sign = \quad, % Seperator between label and title
list entry=Definition~\thetcbcounter \quad #2, % List entry
boxrule=0.5pt, % Frame width
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
detach title, % Title is not part of the box
code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}} % Add title back
}{df}

\newtcbtheorem[auto counter, number within=chapter]{method}{Method} % Method box
{colback=lightblue, % Background color
colframe=black, % Frame color
coltitle=black, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Method~\thetcbcounter, % Title
separator sign = \quad, % Seperator between label and title
boxrule=0.5pt, % Frame width
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
detach title, % Title is not part of the box
code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}} % Add title back
}{mt}

\newtcbtheorem[auto counter, number within=chapter]{proof}{Proof} % Proof box
{colback=white, % Background color
coltitle=black, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Proof~\thetcbcounter, % Title
separator sign = \quad, % Seperator between label and title
borderline west={3pt}{0pt}{black}, % Left border
frame hidden, % No frame
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
detach title, % Title is not part of the box
code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}} % Add title back
}{pf}

\newtcbtheorem[auto counter, number within=chapter]{example}{Example} % Example box
{colback=white, % Background color
coltitle=brightgreen, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Example~\thetcbcounter, % Title
separator sign = \quad, % Seperator between label and title
borderline west={3pt}{0pt}{brightgreen}, % Left border
frame hidden, % No frame
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
detach title, % Title is not part of the box
code={\ifdefempty{\tcbtitletext}{}{\tcbset{before upper={\tcbtitle\par\medskip}}}} % Add title back
}{ex}

\newtcolorbox[]{important}{ % Important box
colback=white, % Background color
coltitle=red, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
title=Important, % Title
borderline west={3pt}{0pt}{red}, % Left border
frame hidden, % No frame
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
}

\newtcolorbox[]{highlight}{ % Highlight box
colback=white, % Background color
coltitle=darkblue, % Title color
fonttitle=\large\bfseries\sffamily, % Title font
borderline west={3pt}{0pt}{darkblue}, % Left border
frame hidden, % No frame
sharp corners, % No rounded corners
enhanced jigsaw, % Better frame drawing
}

% OTHER ---------------------------------------
\usepackage[style=ddmmyyyy]{datetime2} % Generates todays date 
\usepackage{lipsum} % Generates lorem ipsum text
\usepackage{chemfig} % For drawing chemical structures
